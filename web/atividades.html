<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Atividades</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Atividades da Turma: <span id="nomeTurma"></span></h2>
        <h3>Bem-vindo, <span id="nomeProf"></span></h3>
        <button class="btn btn-danger" onclick="logout()">Sair</button>
        <button class="btn btn-primary" onclick="window.location.href=`cadastro_atividade.html?turma_id=${getTurmaId()}`">Cadastrar Atividade</button>
        <table class="table" id="atividadesTable">
            <thead><tr><th>Número</th><th>Descrição</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
    <script>
        function getTurmaId() { return new URLSearchParams(window.location.search).get('turma_id'); }
        async function loadData() {
            const turma_id = getTurmaId();
            const resUser = await fetch('http://localhost:3000/check-session', {credentials: 'include'});
            if (!resUser.ok) window.location.href = 'index.html';
            const user = await resUser.json();
            document.getElementById('nomeProf').textContent = user.nome;

            const resTurma = await fetch(`http://localhost:3000/turmas/${turma_id}`, {credentials: 'include'});
            const turma = await resTurma.json();
            document.getElementById('nomeTurma').textContent = turma.nome;

            const resAtiv = await fetch(`http://localhost:3000/atividades?turma_id=${turma_id}`, {credentials: 'include'});
            const ativs = await resAtiv.json();
            const tbody = document.querySelector('#atividadesTable tbody');
            tbody.innerHTML = '';
            ativs.forEach((ativ, index) => {
                tbody.innerHTML += `<tr><td>${index+1}</td><td>${ativ.descricao}</td></tr>`;
            });
        }
        function logout() { fetch('http://localhost:3000/logout', {method: 'POST', credentials: 'include'}).then(() => window.location.href = 'index.html'); }
        window.onload = loadData;
    </script>
</body>
</html>